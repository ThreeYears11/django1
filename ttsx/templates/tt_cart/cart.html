{% extends 'base.html' %}
{% block head %}
    <title>天天生鲜-购物车</title>
    <link rel="stylesheet" type="text/css" href="/static/css/reset.css">
    <link rel="stylesheet" type="text/css" href="/static/css/main.css">
    <script type="text/javascript" src="/static/js/jquery-1.12.4.min.js"></script>
    <script type="">
        $(function () {
            $('.cart_id').hide();
            goods();

            function goods() {
                var x = 0;
                var y = 0;
                $('.cart_con ul').each(function (i, j) {
                    {#                console.log(j);#}
                    var a = $(j).children('.col05').html();
                    var b = $(j).children('.col06').children().children('.num_show').val();
                    a = a.replace('元', '');
                    $(j).children('.col07').html((a * b).toFixed(2) + "元");
                    y += a * b;
                    x += parseInt(b)
                });
                {#            x = parseFloat(x.toFixed(2));#}
                y = y.toFixed(2);
                $('.settlements .col03').html("合计(不含运费)：<span>¥</span><em>" + y + "元" + "</em><br>共计<b>" + x +
                    "</b>件商品");
            }

            $('.cart_list_td .col06 .add').click(function () {
                var text_val = $(this).siblings('.num_show');
                text_val.val(parseInt(text_val.val()) + 1);
                goods();
            });
            $('.cart_list_td .col06 .minus').click(function () {
                var text_val = $(this).siblings('.num_show');
                if (text_val.val() != 0) {
                    text_val.val(parseInt(text_val.val()) - 1)
                }
                goods()
            });
            $('.cart_list_td .col08 a').click(function () {
                var cart = $('.cart_id').html();
                console.log(cart);
                $.post('/cart/delete/', {'id': cart}, function () {
                    refresh(cart)
                })
            });
            $('.num_add a').click(function () {
                var cart = $(this).parent().parent().siblings('.cart_id').html();
                console.log($(this).html());
                if ($(this).html() == '+') {
                    $.post('/cart/add/', {'id': cart, 'add': '1'}, function () {
                    })
                } else if ($(this).html() == '-') {
                    $.post('/cart/add/', {'id': cart, 'add': '-1'})
                }
            });

            function refresh(id) {
                $('.cart_con .cart_list_td').each(function (i, j) {
                    var ul_id = $(j).children('.cart_id').html();
                    console.log(ul_id);
                    console.log(id);
                    if (ul_id == id) {
                        $(this).html('')
                    }
                })
            }
        })
    </script>
{% endblock head %}
{% block body %}
    <div class="search_bar clearfix">
        <a href="index.html" class="logo fl"><img src="/static/images/logo.png"></a>
        <div class="sub_page_name fl">|&nbsp;&nbsp;&nbsp;&nbsp;购物车</div>
        <div class="search_con fr">
            <input type="text" class="input_text fl" name="" placeholder="搜索商品">
            <input type="button" class="input_btn fr" name="" value="搜索">
        </div>
    </div>

    <div class="total_count">全部商品<em>2</em>件</div>
    <ul class="cart_list_th clearfix">
        <li class="col01">商品名称</li>
        <li class="col02">商品单位</li>
        <li class="col03">商品价格</li>
        <li class="col04">数量</li>
        <li class="col05">小计</li>
        <li class="col06">操作</li>
    </ul>
    <div class="cart_con">
        {% for good in list %}
            <ul class="cart_list_td clearfix">
                <li class="cart_id">{{ good.goods.id }}</li>
                <li class="col01"><input type="checkbox" name="" checked></li>
                <li class="col02"><img src="/static/{{ good.goods.gpic }}"></li>
                <li class="col03">奇异果<br><em>25.80元/500g</em></li>
                <li class="col04">{{ good.goods.gunit }}</li>
                <li class="col05">{{ good.goods.gprice }}元</li>
                <li class="col06">
                    <div class="num_add">
                        <a href="javascript:;" class="add fl">+</a>
                        <input type="text" class="num_show fl" value="{{ good.count }}">
                        <a href="javascript:;" class="minus fl">-</a>
                    </div>
                </li>
                <li class="col07">25.80元</li>
                <li class="col08"><a href="javascript:;">删除</a></li>
            </ul>
        {% endfor %}
        {#    <ul class="cart_list_td clearfix">#}
        {#        <li class="col01"><input type="checkbox" name="" checked></li>#}
        {#        <li class="col02"><img src="/static/images/goods/goods012.jpg"></li>#}
        {#        <li class="col03">奇异果<br><em>25.80元/500g</em></li>#}
        {#        <li class="col04">500g</li>#}
        {#        <li class="col05">25.80元</li>#}
        {#        <li class="col06">#}
        {#            <div class="num_add">#}
        {#                <a href="javascript:;" class="add fl">+</a>#}
        {#                <input type="text" class="num_show fl" value="1">#}
        {#                <a href="javascript:;" class="minus fl">-</a>#}
        {#            </div>#}
        {#        </li>#}
        {#        <li class="col07">25.80元</li>#}
        {#        <li class="col08"><a href="javascript:;">删除</a></li>#}
        {#    </ul>#}
        {##}
        {#    <ul class="cart_list_td clearfix">#}
        {#        <li class="col01"><input type="checkbox" name="" checked></li>#}
        {#        <li class="col02"><img src="/static/images/goods/goods003.jpg"></li>#}
        {#        <li class="col03">大兴大棚草莓<br><em>16.80元/500g</em></li>#}
        {#        <li class="col04">500g</li>#}
        {#        <li class="col05">16.80元</li>#}
        {#        <li class="col06">#}
        {#            <div class="num_add">#}
        {#                <a href="javascript:;" class="add fl">+</a>#}
        {#                <input type="text" class="num_show fl" value="1">#}
        {#                <a href="javascript:;" class="minus fl">-</a>#}
        {#            </div>#}
        {#        </li>#}
        {#        <li class="col07">16.80元</li>#}
        {#        <li class="col08"><a href="javascript:;">删除</a></li>#}
        {#    </ul>#}

    </div>
    <ul class="settlements">
        <li class="col01"><input type="checkbox" name="" checked=""></li>
        <li class="col02">全选</li>
        <li class="col03">合计(不含运费)：<span>¥</span><em>42.60</em><br>共计<b>2</b>件商品</li>
        <li class="col04"><a href='/order/place_order/?id=1'>去结算</a></li>
    </ul>
{% endblock body %}
